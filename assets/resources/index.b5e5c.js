System.register("chunks:///_virtual/MultSpine.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,a,n,i,s,l,o,u,c,h,d,f;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){r=e.cclegacy,a=e.gfx,n=e.Material,i=e.game,s=e.Game,l=e.sp,o=e.director,u=e.Director,c=e.resources,h=e.Texture2D,d=e.renderer,f=e.Color}],execute:function(){r._RF.push({},"4f71ajigRVC9akaYdv+KRlB","MultSpine",void 0);var p=0,m=-1,_=0,v=0,x=[],B=null,b=null,M=new Map,g=new Map,w=new a.BufferTextureCopy;w.texExtent.width=128,w.texExtent.height=128,w.texOffset.x=0,w.texOffset.y=0,n.prototype.spineCache=[];var E=e("SpineBatch",{enable:!1,parent:null,next:function(){M.clear(),v=0,_=0,m=-1},reset:function(){this.next(),p=0},active:function(){return this.enable&&this.parent},update:function(){if(this.active()){for(var e,r=t(g.values());!(e=r()).done;){var a=e.value;a&&(a.n=0)}if(p>0&&B){var n=B._getGFXDevice(),i=B.getGFXTexture(),s=1+~~((4*p-1)/128);w.texExtent.height=s>128?128:s,n.copyBuffersToTexture([b],i,[w])}}}}),S=function(){var e=r.internal.Batcher2D.prototype,t=e.commitMiddleware;e.commitMiddleware=function(e,r,n,i,s,l,o){if(!e.isMult)return t.call(this,e,r,n,i,s,l,o);var u=s.getGFXTexture(),c=u.objectID;void 0===(_=M.get(c))&&v>=8||this._middlewareBuffer!==r||m!==l||this._middlewareIndexStart+this._middlewareIndexCount!==n||this._currLayer!==e.node.layer?(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._currComponent=e,this._currTexture=u,this._currSampler=s.getGFXSampler(),this._currTextureHash=s.getHash(),this._currLayer=e.node.layer,this._currSamplerHash=this._currSampler.hash,this._currHash=0,this._currTransform=null,this._middlewareEnableBatch=!1,this._middlewareBuffer=r,this._middlewareIndexStart=n,this._middlewareIndexCount=i,this._currMaterial=function(e,t){m=t;var r=g.get(t);void 0===r&&(r={mats:[],n:0},g.set(t,r));var n=r.n++,i=r.mats,s=i[n];if(void 0!==s)return x=s.spineCache,s;var l=15&t,o=t>>4&15,u=t>>8&15,c=E.parent;return s=new d.MaterialInstance({parent:c}),i[n]=s,s.overridePipelineStates({blendState:{blendColor:f.WHITE,targets:[{blendEq:a.BlendOp.ADD,blendAlphaEq:a.BlendOp.ADD,blendSrc:o,blendDst:u,blendSrcAlpha:o,blendDstAlpha:u}]}}),s.recompileShaders({TWO_COLORED:1===l,USE_LOCAL:!1}),s.setProperty("spineData",B),x=s.spineCache=[],s.addRef(),s}(0,l)):this._middlewareIndexCount+=i,this._currIsMiddleware=!0,0!==v&&void 0!==_||(_=v++,M.set(c,_)),x[_]!==c&&(x[_]=c,this._currMaterial.setProperty("texture"+_,s))};var n=e.mergeBatchesForMiddleware;e.mergeBatchesForMiddleware=function(e){this._currIsMiddleware&&E.next(),n.call(this,e)}};i.once(s.EVENT_GAME_INITED,(function(){l.Skeleton&&(!function(){E.enable=!1;var e=128;o.root.device.getFormatFeatures(a.Format.RGBA32F)&a.FormatFeatureBit.SAMPLED_TEXTURE&&(E.enable=!0,B=new h,b=new Float32Array(65536),B.setFilters(h.Filter.NEAREST,h.Filter.NEAREST),B.reset({width:e,height:e,format:h.PixelFormat.RGBA32F,mipmapLevel:0}),B.uploadData(b))}(),E.enable&&(E.parent||c.load("multSpines/Mult-spine",n,(function(e,t){e||(E.parent=t,t.addRef())})),function(){var e=l.Skeleton.prototype;e.isMult=!1,Object.defineProperty(e,"enableBatch",{get:function(){return!!this.customMaterial&&this._enableBatch},set:function(e){this.customMaterial&&e!==this._enableBatch&&(this._enableBatch=e,this._updateBatch())}});var t=e.getMaterialForBlendAndTint;e.getMaterialForBlendAndTint=function(e,r,a){if(!E.active()||this.customMaterial)return this.isMult=!1,t.call(this,e,r,a);var n=a|e<<4|r<<8;return this.isMult=!0,n};var r=e._render;e._render=function(e){if(!this.isMult)return r.call(this,e);var t=0;if(this.renderData&&this._drawList.length>0){for(var a=this.renderData,n=a.chunk,i=n.vertexAccessor,s=a.getMeshBuffer(),l=s.indexOffset,o=s.vertexFormatBytes>>2,u=this._drawList.length>1,c=n.vertexOffset,h=a.vertexCount,d=a.chunk.vb,f=a.indices,m=!1,v=0;v<this._drawList.length;v++){var x=this._drawList.data[v];if(x.texture&&(e.commitMiddleware(this,s,l+x.indexOffset,x.indexCount,x.texture,x.material,this._enableBatch),m=!0,u)){var B=x.indexOffset;h=x.indexCount;for(var M=10*p+_;h--;)d[(f[B++]-c)*o+2]=M}t+=x.indexCount}if(!u&&m)for(var g=10*p+_,w=0,E=0;w<h;w++)d[E+2]=g,E+=o;if(m){var S=16*p++,F=b,T=this.node.worldMatrix;F[S]=T.m00,F[S+1]=T.m01,F[S+2]=T.m02,F[S+3]=T.m03,F[S+4]=T.m04,F[S+5]=T.m05,F[S+6]=T.m06,F[S+7]=T.m07,F[S+8]=T.m08,F[S+9]=T.m09,F[S+10]=T.m10,F[S+11]=T.m11,F[S+12]=T.m12,F[S+13]=T.m13,F[S+14]=T.m14,F[S+15]=T.m15}var y=a.indices.subarray(0,t);i.appendIndices(n.bufferId,y),i.getMeshBuffer(n.bufferId).setDirty()}}}(),S()))})),o.on(u.EVENT_AFTER_DRAW,(function(e){E.reset()})),o.on(u.EVENT_BEFORE_COMMIT,(function(e){E.update()}));var F=function e(t,r){if(t){var a=t.getComponent(l.Skeleton);a&&(a.enableBatch=r,a.material=null,a._updateBatch());for(var n=t.children,i=0;i<n.length;i++)e(n[i],r)}};e("switchMultSpine",(function(e,t){E.enable=e;var r=l.Skeleton.prototype;e?Object.defineProperty(r,"enableBatch",{get:function(){return!!this.customMaterial&&this._enableBatch},set:function(e){this.customMaterial&&e!==this._enableBatch&&(this._enableBatch=e,this._updateBatch())}}):Object.defineProperty(r,"enableBatch",{get:function(){return this._enableBatch},set:function(e){e!==this._enableBatch&&(this._enableBatch=e,this._updateBatch())}});var a=o.getScene();a&&F(a,t)}));r._RF.pop()}}}));

System.register("chunks:///_virtual/MultTextures.ts",["cc","./env"],(function(t){var e,r,a,i,s,n,u,h,l,c,o,f,d,p,D,v,m,y,_,M,x;return{setters:[function(t){e=t.cclegacy,r=t.gfx,a=t.Material,i=t.Component,s=t.ImageAsset,n=t.Texture2D,u=t.game,h=t.Game,l=t.director,c=t.Director,o=t.StencilManager,f=t.resources,d=t.renderer,p=t.murmurhash2_32_gc,D=t.Color,v=t.Label,m=t.BitmapFont,y=t.Sprite,_=t.MotionStreak,M=t.TiledLayer},function(t){x=t.JSB}],execute:function(){e._RF.push({},"bd7e7vtojdMUJODlbuIb/Yi","MultTextures",void 0);r.Texture.prototype.texID=-1,a.prototype.isMult=!1,i.prototype.useMult=!1;var g=t("MultBatch2D",{native:!1,enable:!1,parent:null,incID:0,count:0,hash:0,reset:function(){this.incID+=this.count,this.count=0}}),I=new s({width:1,height:1,_compressed:!1,format:r.Format.RGBA32F,_data:new Float32Array(4).fill(0)}),b=new n;b.setFilters(1,1),b.image=I,b.addRef();var T=function(){g.enable=!1,f.load("multTextures/Mult-material",a,(function(t,r){if(!t){var i=e.builtinResMgr.get("ui-sprite-material");i&&(i._hash=g.hash=a.getHash(i),g.parent=r,g.enable=!0,r.addRef())}}))},V=0,U=[];u.once(h.EVENT_GAME_INITED,(function(){g.native||T()}));var S=function(t,e,r,a){var i=r.renderData,s=i.chunk,n=i.data,u=s.vb,h=i.vertexCount;if(t.hasChangedFlags||1===i.dataDirty)for(var l=t.worldMatrix,c=l.m00,o=l.m01,f=l.m02,d=l.m03,p=l.m04,D=l.m05,v=l.m06,m=l.m07,y=l.m12,_=l.m13,M=l.m14,x=l.m15,g=1/255,I=0,b=0;b<h;b++){var T=n[b],V=T.x,U=T.y,S=d*V+m*U+x;S=S?1/S:1,u[I+0]=(c*V+p*U+y)*S,u[I+1]=(o*V+D*U+_)*S,u[I+2]=(f*V+v*U+M)*S,u[I+5]=a.r*g,u[I+6]=a.g*g,u[I+7]=a.b*g,u[I+8]=a.a*g,I+=9}s.bufferId;for(var A=s.vertexOffset,R=s.meshBuffer,F=s.meshBuffer.iData,H=R.indexOffset,B=0,E=h/4;B<E;B++){var k=A+4*B;F[H++]=k,F[H++]=k+1,F[H++]=k+2,F[H++]=k+1,F[H++]=k+3,F[H++]=k+2}R.setDirty(),R.indexOffset+=i.indexCount};u.once(h.EVENT_ENGINE_INITED,(function(){if(!g.native){!function(){var t=new D(255,255,255,255),e=new D(255,255,255,255),r=function(e,r){var a=e.node;t.set(e.color),t.a=255*a._uiProps.opacity,S(a,0,e,t)},a=function(t,r){if(t.renderData){var a=t.node;e.a=255*a._uiProps.opacity,S(a,0,t,e)}};v.prototype.useMult=!0;var i=v.Assembler;if(i){var s=i.getAssembler;i.getAssembler=function(t){var e=s.call(this,t);if(null==e.changeUV){e.changeUV=function(t){var e=t.renderData;e&&(e.dataDirty=1)};var i=e.updateUVs;i&&(t.font instanceof m||t.cacheMode===v.CacheMode.CHAR?e.updateUVs=function(t){i.call(this,t),this.changeUV(t)}:e.updateUVs=function(t){i.call(this,t),t.renderData&&t.ttfSpriteFrame&&this.changeUV(t)})}return t.font instanceof m?e.fillBuffers=r:e.fillBuffers=a,e}}}(),function(){y.prototype.useMult=!0;var t=y.Assembler;if(t){var e=t.getAssembler;t.getAssembler=function(t){var r=e.call(this,t);if(null==r.changeUV){r.changeUV=function(t){var e=t.renderData;e&&(e.dataDirty=1)};var a=r.updateUVs;a&&(t.type==y.Type.FILLED?t.fillType!=y.FillType.RADIAL&&(r.updateUVs=function(t,e,r){a.call(this,t,e,r),this.changeUV(t)}):t.type!=y.Type.TILED&&(r.updateUVs=function(t){a.call(this,t),t.spriteFrame&&this.changeUV(t)}));var i=r.updateWorldVertexAndUVData;i&&(r.updateWorldVertexAndUVData=function(t,e){i.call(this,t,e),this.changeUV(t)})}return r}}}(),function(){var t=e.UI.RenderData.prototype;t.texID=-1,t.isMult=!1,t.matDirty=!0,t.texDirty=!0,t.dataDirty=0,t.updateHash=function(){if(this.isMult&&g.enable){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+"98k";this.dataHash=p(t,666),this.hashDirty=!1}else{var e=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=p(e,666),this.hashDirty=!1}this.matDirty=!1},Object.defineProperty(t,"textureDirty",{get:function(){return this.texDirty},set:function(t){this.texDirty=t,!0===t&&(this.texID=-1)}});var r=function(t,e){t.isMult=!1;var r=e.getRenderMaterial(0);r&&g.enable&&e.useMult&&!t._isMeshBuffer&&(r._hash=r.hash||r._hash,r._hash||(r._hash=a.getHash(r)),t.isMult=g.hash==r._hash)},i=t.updatePass;t.updatePass=function(t){r(this,t),i.call(this,t)};var s=t.updateRenderData;t.updateRenderData=function(t,e){this.passDirty&&r(this,t),s.call(this,t,e)}}(),function(){if(M&&!x){var t=M.prototype;t.useMult=!0,t.dataDirty=!1;var e=t.setUserNodeDirty;t.setUserNodeDirty=function(t){e.call(this,t),t||(this.dataDirty=!0)},t._render=function(t){for(var e=this,r=this.node.layer,a=function(a){e._tiledDataArrayIdx=i;var n=e._tiledDataArray[i];if(e._drawInfoList[a],n.subNodes)n.subNodes.forEach((function(e){e&&(t.walk(e.node),a++)}));else{var u=n;if(u.texture){var h=!1,l=u.renderData;l.material=e.getRenderMaterial(0),l.texture!==u.texture&&(l.texture=u.texture),l.layer!==r&&(l.layer=r,h=!0),l.isMult=!0,h&&l.updateHash(),e.dataDirty&&(l.dataDirty=1),t.commitComp(e,u.renderData,u.texture,e._assembler,null),a++}}s=a},i=0,s=0;i<this._tiledDataArray.length;i++)a(s);this.dataDirty=!1,this.node._static=!0}}}(),function(){if(_){var t=_.prototype;t.useMult=!0;var e=t.lateUpdate;t.lateUpdate=function(t){if(e.call(this,t),this._assembler&&this.points.length>=2){var r=this.renderData;r&&(r.dataDirty=1)}}}}(),l.on(c.EVENT_AFTER_DRAW,(function(t){g.reset(),V=0}));var t=e.internal.Batcher2D.prototype;t.isMult=!1,t.isNative=x,t.cacheTextures=[],t.currMaterial=null,Object.defineProperty(t,"_currMaterial",{get:function(){return this.currMaterial},set:function(t){var e=this._currRenderData;t==this._emptyMaterial&&(e=null),this.currMaterial=function(t,e){void 0===e&&(e=null);var r=g;if(r.reset(),!(r.enable&&t&&e&&e.isMult))return t;if(!r.parent||!r.parent.isValid)return T(),t;var a=U[V++];if(!a||!a.isValid){var i={parent:r.parent};a=new d.MaterialInstance(i),U[V-1]=a,a.cacheTextures=[],a.isMult=!0,a.addRef()}return a}(t,e),this.isMult=!1,g.enable&&this.currMaterial&&this.currMaterial.isMult&&(this.cacheTextures=this.currMaterial.cacheTextures,this.isMult=!0)}});t.commitComp=function(t,e,r,a,i){var s=0,n=null,u=-1;if(e&&e.chunk){if(!e.isValid())return;s=e.dataHash,n=e.material,u=e.chunk.bufferId}2===t.stencilStage||6===t.stencilStage?this._insertMaskBatch(t):t._stencilStage=o.sharedManager.stage;var h=t.stencilStage,l=-1,c=null,f=g,d=!1,p=this.isNative;if(f.enable&&e&&e.isMult&&(r&&r.isValid&&(c=r.getGFXTexture()),c&&(void 0===c.texID&&(c.texID=-1),d=(l=c.texID-f.incID)<0&&f.count>=8,this.isMult&&(n=this._currMaterial))),(d||this._currHash!==s||0===s||this._currMaterial!==n||this._currDepthStencilStateStage!==h)&&(this.autoMergeBatches(this._currComponent),p||!e||e._isMeshBuffer||this.updateBuffer(e.vertexFormat,u),this._currRenderData=e,this._currHash=e?e.dataHash:0,this._currComponent=t,this._currTransform=i,this._currMaterial=t.getRenderMaterial(0),this._currDepthStencilStateStage=h,this._currLayer=t.node.layer,r?(this._currTexture=r.getGFXTexture(),this._currSampler=r.getGFXSampler(),this._currTextureHash=r.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),!p&&a.fillBuffers&&a.fillBuffers(t,this),c&&this.isMult){if(l<0||0===f.count){l=f.count++,c.texID=l+f.incID;var D=this.cacheTextures;D[l]!==c&&(D[l]=c,(c=r.texture)||(c=r),this._currMaterial.setProperty("texture"+l,c))}this.fillTextureID(e,l),p&&e.renderDrawInfo.setMaterial(this._currMaterial)}},t.fillTextureID=function(t,e){var r=t.chunk.vb,a=0,i=r.length;if(1===t.dataDirty)for(var s=0;s<i;s+=9)a=~~(1e5*r[s+3]),r[s+3]=10*a+e;else if(t.texID!==e)for(var n=0;n<i;n+=9)a=~~(.1*r[n+3]),r[n+3]=10*a+e;t.dataDirty=0,t.texID=e}}})),e._RF.pop()}}}));

System.register("chunks:///_virtual/resources",["./MultSpine.ts","./MultTextures.ts"],(function(){return{setters:[null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/resources', 'chunks:///_virtual/resources'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});